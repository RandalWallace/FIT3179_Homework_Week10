{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "width": 1500,
  "height": 700,
  "autosize": {"type": "fit", "contains": "padding"},
  "title": {
    "text": "Global Minimum Wage (USD) with Happiness Scores (2023)",
    "fontSize": 20,
    "fontWeight": "bold",
    "anchor": "middle",
    "font": "Montserrat"
  },
  "config": {
    "axis": {"labelFont": "Montserrat", "titleFont": "Montserrat"},
    "legend": {"labelFont": "Montserrat", "titleFont": "Montserrat"},
    "header": {"labelFont": "Montserrat", "titleFont": "Montserrat"},
    "title": {"font": "Montserrat"}
  },
  "projection": {"type": "equirectangular", "scale": 200, "translate": [750, 350]},
  "layer": [
    {
      "data": {
        "url": "https://raw.githubusercontent.com/RandalWallace/FIT3179_Assignment2/main/ne_110m.json",
        "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
      },
      "mark": {"type": "geoshape", "stroke": "#ffffff", "strokeWidth": 0.5},
      "transform": [
        {
          "lookup": "properties.NAME",
          "from": {
            "data": {
              "url": "https://raw.githubusercontent.com/RandalWallace/FIT3179_Assignment2/main/data/minimum_wage.csv"
            },
            "key": "Country",
            "fields": ["Hourly-PPP (Int$)", "Effective per"]
          }
        },
        {"calculate": "isValid(datum['Hourly-PPP (Int$)']) ? datum['Hourly-PPP (Int$)'] : 0", "as": "HourlyPPP_Zero"},
        {
          "calculate": "datum.HourlyPPP_Zero === 0 ? 'No Data Available' : '$' + format(datum.HourlyPPP_Zero, '.2f')",
          "as": "formatted_wage"
        }
      ],
      "encoding": {
        "color": {
          "field": "HourlyPPP_Zero",
          "type": "quantitative",
          "scale": {"range": ["#e5f5e0", "#00441b"]},
          "title": "Minimum Wage (PPP-Adjusted)",
          "legend": {
            "orient": "bottom",
            "columns": 4,
            "labelFontSize": 10,
            "symbolSize": 60,
            "labelLimit": 0,
            "labelFont": "Montserrat",
            "titleFont": "Montserrat"
          }
        },
        "tooltip": [
          {"field": "properties.NAME", "title": "üåç Country"},
          {"field": "formatted_wage", "title": "üí∞ Hourly Minimum Wage (PPP)"},
          {"field": "Effective per", "title": "üìÖ Effective As Of"}
        ]
      }
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/RandalWallace/FIT3179_Assignment2/main/ne_110m.json",
        "format": {"type": "topojson", "feature": "ne_110m_graticules_30"}
      },
      "mark": {"type": "geoshape", "fill": null, "stroke": "black", "strokeOpacity": 0.15}
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/RandalWallace/FIT3179_Assignment2/main/ne_110m.json",
        "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
      },
      "transform": [
        {
          "lookup": "properties.SUBUNIT",
          "from": {
            "data": {
              "url": "https://raw.githubusercontent.com/RandalWallace/FIT3179_Assignment2/main/data/happiness_report.csv"
            },
            "key": "Country",
            "fields": ["Happiness Score", "Happiness Rank", "Health (Life Expectancy)"]
          }
        },
        {
          "filter": "isValid(datum['Happiness Score']) && isValid(datum.properties.LABEL_X) && isValid(datum.properties.LABEL_Y)"
        },
        {
          "calculate": "datum.properties.LABEL_Y + (datum['Happiness Score'] / 10) * 8",
          "as": "spike_end_lat"
        },
        {
          "calculate": "'#' + datum['Happiness Rank'] + ' of 158'",
          "as": "formatted_rank"
        },
        {
          "calculate": "datum['Happiness Score'] >= 7 ? 'Very Happy' : datum['Happiness Score'] >= 6 ? 'Happy' : datum['Happiness Score'] >= 5 ? 'Moderate' : datum['Happiness Score'] >= 4 ? 'Below Average' : 'Low Happiness'",
          "as": "happiness_category"
        }
      ],
      "mark": {"type": "rule", "stroke": "#F0982E", "strokeWidth": 2.5},
      "encoding": {
        "longitude": {"field": "properties.LABEL_X"},
        "latitude": {"field": "properties.LABEL_Y"},
        "longitude2": {"field": "properties.LABEL_X"},
        "latitude2": {"field": "spike_end_lat"},
        "opacity": {
          "field": "Happiness Score",
          "type": "quantitative",
          "scale": {"domain": [1, 10], "range": [0, 1]},
          "title": "Happiness Score (Length & Intensity)",
          "legend": {
            "orient": "bottom",
            "columns": 5,
            "labelFontSize": 10,
            "symbolSize": 60,
            "labelLimit": 0,
            "labelFont": "Montserrat",
            "titleFont": "Montserrat"
          }
        },
        "tooltip": [
          {"field": "properties.SUBUNIT", "title": "üåç Country"},
          {"field": "happiness_category", "title": "üòä Happiness Level"},
          {"field": "Happiness Score", "type": "quantitative", "title": "üìä Happiness Score", "format": ".2f"},
          {"field": "formatted_rank", "title": "üèÜ Global Ranking"},
          {"field": "Health (Life Expectancy)", "type": "quantitative", "title": "üè• Life Expectancy Index", "format": ".3f"}
        ]
      }
    },
    {
      "data": {
        "values": [
          {
            "country": "Australia",
            "lon": 135,
            "lat": -25,
            "label_lon": 125,
            "label_lat": -45,
            "note": "Australia"
          }
        ]
      },
      "layer": [
        {
          "mark": {
            "type": "text",
            "font": "Montserrat",
            "fontSize": 15,
            "fontWeight": "bold",
            "align": "center",
            "dx": 5,
            "dy": 5
          },
          "encoding": {
            "longitude": {"field": "label_lon"},
            "latitude": {"field": "label_lat"},
            "text": {"field": "note"},
            "color": {"value": "#2c3e50"}
          }
        },
        {
          "mark": {"type": "rule", "stroke": "#2c3e50", "strokeDash": [4, 2], "strokeWidth": 1.5},
          "encoding": {
            "longitude": {"field": "lon"},
            "latitude": {"field": "lat"},
            "longitude2": {"field": "label_lon"},
            "latitude2": {"field": "label_lat"}
          }
        }
      ]
    }
  ]
}
